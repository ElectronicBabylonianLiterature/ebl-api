version: '3'

dotenv: ['.env']

tasks:
  mycommit:
    cmds:
      - poetry run black ebl
      - task: lint
      - task: type
      - git add --all && git commit -m "{{.CLI_ARGS}}" && git push

  test-all:
    cmds:
      - task: format
        vars: {CLI_ARGS: "--check"}
      - task: lint
      - task: type
      - task: test

  test:
    cmds:
      - poetry run pytest {{.CLI_ARGS}}

  lint:
    cmds:
      - poetry run flake8 ebl
  
  type:
    cmds:
      - poetry run pyre check
  
  format:
    cmds:
      - poetry run black ebl {{.CLI_ARGS}}

  start:
    sources:
      - ./ebl/**/*.py
      - ./ebl/**/*.lark
    cmds:
      - poetry run waitress-serve --port=8000 --call ebl.app:get_app
